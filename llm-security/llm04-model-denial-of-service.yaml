rules:
  - id: llm04-model-dos-unlimited-tokens
    message: "Model DoS risk: Unlimited token generation without rate limiting"
    languages: [python, javascript, typescript]
    patterns:
      - pattern: ".*max_tokens.*None|null|undefined.*"
      - pattern: ".*completions.*create.*"
      - pattern-not: ".*max_tokens.*[0-9]+.*"
    severity: MEDIUM
    metadata:
      cwe: "CWE-400"
      owasp-llm: "LLM04"
      category: "model-denial-of-service"
      description: "Detects unlimited token generation that could lead to resource exhaustion"

  - id: llm04-infinite-loop-generation
    message: "Potential infinite generation loop: No termination conditions for LLM calls"
    languages: [python, javascript, typescript]
    patterns:
      - pattern: "while.*True|true.*:"
      - pattern-inside: ".*llm|openai|anthropic.*generate|create.*"
      - pattern-not: ".*break|return|exit.*"
    severity: HIGH
    metadata:
      cwe: "CWE-835"
      owasp-llm: "LLM04"
      category: "model-denial-of-service"
      description: "Detects infinite loops that could cause continuous LLM API calls"

  - id: llm04-resource-exhaustion
    message: "Resource exhaustion risk: Large batch processing without limits"
    languages: [python, javascript, typescript]
    patterns:
      - pattern: ".*batch.*process.*llm|openai.*"
      - pattern: ".*for.*in.*large.*data.*"
      - pattern-not: ".*limit|batch_size.*[0-9]+.*"
    severity: MEDIUM
    metadata:
      cwe: "CWE-400"
      owasp-llm: "LLM04"
      category: "model-denial-of-service"
      description: "Detects large-scale batch processing without resource limits"