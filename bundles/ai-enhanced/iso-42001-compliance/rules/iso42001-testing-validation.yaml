version: "1.0"
id: "tavoai-iso42001-testing-validation"
name: "ISO 42001: AI Testing and Validation"
category: "compliance"
subcategory: "testing-validation"
severity: "high"
rule_type: "hybrid"

standards:
  cwe: ["CWE-20"]
  capec: ["CAPEC-124"]
  owasp_llm: ["LLM09"]
  iso_42001: ["8.2.1"]
  nist_ai_rmf: ["VALIDATE-2.1"]

compatible_models:
  - "openai/gpt-4"
  - "anthropic/claude-3-opus"

tags:
  - "iso-42001"
  - "testing"
  - "validation"

heuristics:
  - type: "semgrep"
    languages: ["python"]
    pattern: |
      # Detect model training without validation
      model.fit($DATA)
      # No validation code follows
    message: "Model training without validation testing"
    severity: "high"

ai_analysis:
  trigger:
    - "heuristics_matched"
  high_risk_patterns:
    - "*/test/*"
    - "*/validation/*"

  prompt_template: |
    Analyze for ISO 42001 Section 8.2.1 testing and validation compliance.

    Code: {code_snippet}
    Context: {heuristic_findings}

    Check for:
    1. Unit testing of AI components
    2. Integration testing
    3. Performance validation
    4. Robustness testing
    5. Bias and fairness testing

  expected_response_schema:
    type: "object"
    required: ["severity", "vulnerable_lines", "compliance_gaps", "remediation", "standards_mapping", "confidence"]
    properties:
      severity: { enum: ["low", "medium", "high", "critical"] }
      vulnerable_lines: { type: "array", items: { type: "number" } }
      compliance_gaps: { type: "string", minLength: 100 }
      remediation: { type: "string", minLength: 100 }
      standards_mapping: { type: "object", properties: { iso_42001: { type: "array", items: { type: "string" } } } }
      confidence: { type: "number", minimum: 0, maximum: 1 }

execution:
  max_tokens: 1800
  temperature: 0.1
  cache_results: true

sarif_output:
  rule_id: "tavoai-iso42001-testing-validation"
  rule_name: "ISO 42001 Testing and Validation"
  short_description: "Validates AI testing practices per ISO 42001"
  full_description: "Checks for comprehensive testing and validation of AI systems"
  help_uri: "https://docs.tavoai.com/rules/iso42001-testing-validation"
  tags: ["compliance", "testing", "iso-42001"]
