version: "1.0"
id: "tavoai-owasp-llm07-pro"
name: "OWASP LLM07: Insecure Plugin Design (Pro)"
category: "security"
subcategory: "plugin-design"
severity: "medium"
rule_type: "hybrid"

standards:
  cwe: ["CWE-284", "CWE-862"]
  capec: ["CAPEC-17", "CAPEC-36"]
  owasp_llm: ["LLM07"]

compatible_models:
  - "openai/gpt-4"

tags:
  - "owasp-llm"
  - "plugin-design"
  - "ai-enhanced"

heuristics:
  - type: "semgrep"
    languages: ["python", "javascript", "typescript"]
    pattern: |
      # Plugin without permission checks
      def execute_plugin(user_input):
          eval(user_input)  # No validation
    message: "Plugin execution without permission validation"
    severity: "medium"

ai_analysis:
  trigger:
    - "high_risk_files"
  high_risk_patterns:
    - "*/plugins/*"
    - "*/extensions/*"
    
  prompt_template: |
    Analyze for insecure plugin design in AI systems:
    Code: {code_snippet}
    Check plugin security, permission models, and isolation mechanisms.

  expected_response_schema:
    type: "object"
    required: ["severity", "vulnerable_lines", "description", "remediation", "standards_mapping", "confidence"]
    properties:
      severity: { enum: ["low", "medium", "high", "critical"] }
      vulnerable_lines: { type: "array", items: { type: "number" } }
      description: { type: "string", minLength: 100 }
      remediation: { type: "string", minLength: 100 }
      standards_mapping: { type: "object", properties: { owasp_llm: { type: "array", items: { type: "string" } } } }
      confidence: { type: "number", minimum: 0, maximum: 1 }

execution:
  max_tokens: 1500
  temperature: 0.1

sarif_output:
  rule_id: "tavoai-owasp-llm07-pro"
  rule_name: "OWASP LLM07 Plugin Design (Pro)"
  short_description: "Advanced plugin security analysis"
  full_description: "Comprehensive analysis of AI plugin security and permission models"
  help_uri: "https://docs.tavoai.com/rules/owasp-llm07-pro"
  tags: ["security", "owasp-llm", "plugin-design", "ai-enhanced"]
EOF && cat > llm08-excessive-agency.yaml << 'EOF'
version: "1.0"
id: "tavoai-owasp-llm08-pro"
name: "OWASP LLM08: Excessive Agency (Pro)"
category: "security"
subcategory: "excessive-agency"
severity: "low"
rule_type: "hybrid"

standards:
  cwe: ["CWE-284", "CWE-862"]
  capec: ["CAPEC-233", "CAPEC-114"]
  owasp_llm: ["LLM08"]

compatible_models:
  - "openai/gpt-4"

tags:
  - "owasp-llm"
  - "excessive-agency"
  - "ai-enhanced"

heuristics:
  - type: "semgrep"
    languages: ["python", "javascript", "typescript"]
    pattern: |
      # Unrestricted LLM function calls
      llm.call_functions(user_input, permissions="unlimited")
    message: "LLM with excessive permissions"
    severity: "low"

ai_analysis:
  trigger:
    - "high_risk_files"
  high_risk_patterns:
    - "*/agents/*"
    - "*/automation/*"
    
  prompt_template: |
    Analyze for excessive agency in AI autonomous systems:
    Code: {code_snippet}
    Check permission boundaries, oversight mechanisms, and agency limits.

  expected_response_schema:
    type: "object"
    required: ["severity", "vulnerable_lines", "description", "remediation", "standards_mapping", "confidence"]
    properties:
      severity: { enum: ["low", "medium", "high", "critical"] }
      vulnerable_lines: { type: "array", items: { type: "number" } }
      description: { type: "string", minLength: 100 }
      remediation: { type: "string", minLength: 100 }
      standards_mapping: { type: "object", properties: { owasp_llm: { type: "array", items: { type: "string" } } } }
      confidence: { type: "number", minimum: 0, maximum: 1 }

execution:
  max_tokens: 1500
  temperature: 0.1

sarif_output:
  rule_id: "tavoai-owasp-llm08-pro"
  rule_name: "OWASP LLM08 Excessive Agency (Pro)"
  short_description: "Advanced excessive agency analysis"
  full_description: "Comprehensive analysis of AI agent permissions and autonomy controls"
  help_uri: "https://docs.tavoai.com/rules/owasp-llm08-pro"
  tags: ["security", "owasp-llm", "excessive-agency", "ai-enhanced"]
EOF && cat > llm09-overreliance.yaml << 'EOF'
version: "1.0"
id: "tavoai-owasp-llm09-pro"
name: "OWASP LLM09: Overreliance (Pro)"
category: "security"
subcategory: "overreliance"
severity: "low"
rule_type: "hybrid"

standards:
  cwe: ["CWE-710", "CWE-20"]
  capec: ["CAPEC-114", "CAPEC-183"]
  owasp_llm: ["LLM09"]

compatible_models:
  - "openai/gpt-4"
  - "anthropic/claude-3-opus"

tags:
  - "owasp-llm"
  - "overreliance"
  - "ai-enhanced"

heuristics:
  - type: "semgrep"
    languages: ["python", "javascript", "typescript"]
    pattern: |
      # Critical decision without verification
      if llm.classify(data) == "malicious":
          block_user()
    message: "Critical security decision based solely on LLM output"
    severity: "low"

ai_analysis:
  trigger:
    - "high_risk_files"
  high_risk_patterns:
    - "*/security/*"
    - "*/auth/*"
    - "*/access/*"
    
  prompt_template: |
    Analyze for overreliance on AI systems without human oversight:
    Code: {code_snippet}
    Check decision-making processes, confidence thresholds, and human-in-the-loop requirements.

  expected_response_schema:
    type: "object"
    required: ["severity", "vulnerable_lines", "description", "remediation", "standards_mapping", "confidence"]
    properties:
      severity: { enum: ["low", "medium", "high", "critical"] }
      vulnerable_lines: { type: "array", items: { type: "number" } }
      description: { type: "string", minLength: 100 }
      remediation: { type: "string", minLength: 100 }
      standards_mapping: { type: "object", properties: { owasp_llm: { type: "array", items: { type: "string" } } } }
      confidence: { type: "number", minimum: 0, maximum: 1 }

execution:
  max_tokens: 1800
  temperature: 0.1

sarif_output:
  rule_id: "tavoai-owasp-llm09-pro"
  rule_name: "OWASP LLM09 Overreliance (Pro)"
  short_description: "Advanced overreliance analysis"
  full_description: "Comprehensive analysis of AI system usage patterns and overreliance risks"
  help_uri: "https://docs.tavoai.com/rules/owasp-llm09-pro"
  tags: ["security", "owasp-llm", "overreliance", "ai-enhanced"]
EOF && cat > llm10-model-theft.yaml << 'EOF'
version: "1.0"
id: "tavoai-owasp-llm10-pro"
name: "OWASP LLM10: Model Theft (Pro)"
category: "security"
subcategory: "model-theft"
severity: "high"
rule_type: "hybrid"

standards:
  cwe: ["CWE-200", "CWE-284"]
  capec: ["CAPEC-167", "CAPEC-165"]
  owasp_llm: ["LLM10"]

compatible_models:
  - "openai/gpt-4"
  - "anthropic/claude-3-opus"

tags:
  - "owasp-llm"
  - "model-theft"
  - "ai-enhanced"

heuristics:
  - type: "semgrep"
    languages: ["python", "javascript", "typescript"]
    pattern: |
      # Exposed model endpoint
      @app.route('/api/model')
      def get_model():
          return send_file('model.pkl')
    message: "Model exposed without authentication"
    severity: "high"

ai_analysis:
  trigger:
    - "always"
  high_risk_patterns:
    - "*/api/*"
    - "*/models/*"
    - "*/downloads/*"
    
  prompt_template: |
    Analyze for AI model theft vulnerabilities:
    Code: {code_snippet}
    Check model protection, access controls, and intellectual property safeguards.

  expected_response_schema:
    type: "object"
    required: ["severity", "vulnerable_lines", "description", "remediation", "standards_mapping", "confidence"]
    properties:
      severity: { enum: ["low", "medium", "high", "critical"] }
      vulnerable_lines: { type: "array", items: { type: "number" } }
      description: { type: "string", minLength: 100 }
      remediation: { type: "string", minLength: 100 }
      standards_mapping: { type: "object", properties: { owasp_llm: { type: "array", items: { type: "string" } } } }
      confidence: { type: "number", minimum: 0, maximum: 1 }

execution:
  max_tokens: 1800
  temperature: 0.1

sarif_output:
  rule_id: "tavoai-owasp-llm10-pro"
  rule_name: "OWASP LLM10 Model Theft (Pro)"
  short_description: "Advanced model theft protection analysis"
  full_description: "Comprehensive analysis of AI model protection and theft prevention measures"
  help_uri: "https://docs.tavoai.com/rules/owasp-llm10-pro"
  tags: ["security", "owasp-llm", "model-theft", "ai-enhanced"]
